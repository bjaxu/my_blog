{% extends "base.html" %}
{% load staticfiles %}
{% block title %} 注册 {% endblock title %}

{% block head %}
<link href="{% static 'css/register.css' %}" rel="stylesheet" type="text/css" media="all">
{% endblock head %}

{% block content %}
<form id="reg_from" class="form-inline" action="." method="post">
    {% csrf_token %}
    <div class="mycenter">
        <div class="mysign">
            <div class="form-group">
                <label class="form-label" for="" style="color: wheat">邀请码</label>
                <input id="invite" type="text" class="form-control" name="invite" required>
            </div>
            <div class="form-group">
                <label class="form-label" for="" style="color: wheat">用户名</label>
                <input id="username" type="text" class="form-control" name="username" required>
            </div>
             <div class="form-group">
                <label class="form-label" for="" style="color: wheat">邮箱</label>
                <input id="email" type="email" class="form-control" name="email" required>
            </div>
            <div class="form-group">
                <label class="form-label" for="" style="color: wheat">密码</label>
                <input id='password', type="password" class="form-control" name="password" required>
            </div>
            <div class="form-group">
                <label class="form-label" for="" style="color: wheat">确认密码</label>
                <input id="password2" type="password" class="form-control" name="password2" required>
            </div>
            <div class="form-group">
                <input type="checkbox" name="allow" id="allow" checked="checked">
                <p style="color: wheat">同意<a href="{% url 'userporfile:agree' %}">用户协议</a></p>
            </div>
            <div class="form-group" style="margin: 0px auto;display: table;">
                <button type="submit" id="btn" class="btn btn-primary">注册账号</button>
            </div>
        </div>
    </div>
</form>
{% endblock content %}
{% block js %}
    <script type="text/javascript">
        $(document).ready(function(){
            // 判断是否有邀请码
            var error_invite = false;
            $('#invite').blur(function () {
                check_invite();
            });
            function check_invite() {
                var len = $('#invite').val().length;
                if(len<=0){
                    layer.tips('请输入邀请码！','#invite',{
                        time:3000,
                        tips:[2,'gold'],
                    });
                    error_invite = true;
                }
                else
                {
                    error_invite = false;
                }
            }
            // 判断用户名是否符合规范
            var error_name = false;
            $('#username').blur(function () {
                check_username();
            });
            function check_username() {
                var len = $('#username').val().length;
                if(len<6||len>20){
                    layer.tips('用户名必须为6-20位！','#username',{
                        time:3000,
                        tips:[2,'blue'],
                    });
                    error_name = true;
                }
                else
                {
                    error_name = false;
                }
            }
            // 判断邮箱是否符合规范
            var error_email = false;
            $('#email').blur(function () {
                check_email();
            });
            function check_email() {
                var re = /^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/;
                if (re.test($('#email').val())) {
                    error_email = false;
                }
                else {
                    layer.tips('请输入正确的邮箱格式！', '#email', {
                        time: 3000,
                        tips: [2, 'green'],
                    });
                    error_email = true;
                }
            }
                // 判断密码是否符合规范
            var error_password = false;
                $('#password').blur(function () {
                check_password();
            });
            function check_password() {
                var len = $('#password').val().length;
                if(len<8||len>20){
                    layer.tips('密码必须为8-20位！','#password',{
                        time:3000,
                        tips:[2,'red'],
                    });
                    error_password = true;
                }
                else
                {
                    error_password = false;
                }
            }
            // 判断2次的面是否相同
            var error_password2 = false;
                $('#password2').blur(function () {
                check_password2();
            });
            function check_password2() {
                var pass1 = $('#password').val();
                var pass2 = $('#password2').val();
                if(pass1 != pass2){
                    layer.tips('2个密码必须相同!','#password2',{
                        time:3000,
                        tips:[2,'red'],
                    });
                    error_password2 = true;
                }
                else
                {
                    error_password2 = false;
                }
            }
            // 判断是否同意用户协议
            var error_check = false;
            $('#allow').click(function () {
                if($(this).is(':checked')){
                    error_check = false;
                }else
                {   layer.tips('请同意用户协议!','#allow',{
                        time:3000,
                        tips:[4,'gray'],
                    });
                error_check = true;
                }
            });
            $('#reg_from').submit(function (){
            check_invite();
            check_username();
            check_email();
            check_password();
            check_password2();
            if(error_email == false && error_password == false && error_password2 == false && error_name == false && error_invite ==false){
                return true;
            }else
            {
                return false;
            }
                  });
        });
        // 判断响应码
        {% if statue == 1 %}
            layer.tips('邀请码错误！','#invite',{
                time:3000,
                tips:[2,'gold'],
            });
            {% elif statue == 2 %}
                  layer.tips('用户名存在！','#username',{
                        time:3000,
                        tips:[2,'blue'],
                    });
            {% elif statue == 3 %}
                  layer.tips('邮箱存在！', '#email', {
                        time: 3000,
                        tips: [2, 'green'],
                    });
            {% elif statue == 4 %}
                        layer.msg("注册登录成功将于", {
                               time: 3000,
                               shade: 1,
                               area: ['40%','50px'],
                               success: function (layero, index) {
                                   var msg = layero.text();
                                   var i = 3;
                                   var timer = null;
                                   var fn = function () {
                                       layero.find(".layui-layer-content").text(msg + '' + i + '' +'秒后转到首页!');
                                       if (!i) {
                                           layer.close(index);
                                           clearInterval(timer);
                                       }
                                       i--;
                                   };
                                   timer = setInterval(fn, 1000);
                                   fn();
                                   },
                           }, function () {
                               window.location.href = '/article/article-list/';
                               });
        {% endif %}
    </script>
{% endblock js %}